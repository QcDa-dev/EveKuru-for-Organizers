<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="common.css">
</head>
<body>
  <div id="loadingOverlay" class="loader-overlay">
    <div class="loader"></div>
  </div>

  <div class="page-container">
    <div id="header-placeholder"></div>

    <main class="main-content is-wide">
        <h1 class="card-title" style="margin-bottom: 2rem;">リリースノート</h1>
        <div id="release-notes-container" class="space-y-8">
            <!-- Release notes will be loaded here -->
        </div>
        <div id="loadingIndicator" class="text-center py-10">
            <div class="loader mx-auto"></div>
        </div>
    </main>

    <footer class="app-footer">
        © 2025 QcDa Project. All Rights Reserved.
    </footer>
  </div>

  <script type="module">
    import { initPage, GITHUB_USER, GITHUB_REPO } from './common.js';
    initPage({ auth: 'public', title: 'リリースノート' });

    document.addEventListener('DOMContentLoaded', () => {
        const container = document.getElementById('release-notes-container');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const apiUrl = `https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}/releases`;

        fetch(apiUrl)
            .then(response => {
                if (!response.ok) throw new Error(`Network response was not ok: ${response.statusText}`);
                return response.json();
            })
            .then(releases => {
                loadingIndicator.classList.add('hidden');
                if (releases.length === 0) {
                    container.innerHTML = '<p class="text-center text-gray-500">リリース情報はまだありません。</p>';
                    return;
                }
                releases.forEach(release => {
                    const releaseDate = new Date(release.published_at).toLocaleDateString('ja-JP');
                    const releaseElement = document.createElement('div');
                    releaseElement.className = 'content-card';
                    const releaseBodyHtml = marked.parse(release.body || '');
                    releaseElement.innerHTML = `
                        <div class="flex justify-between items-center mb-3 flex-wrap gap-2">
                            <h2 class="text-2xl font-bold text-gray-900">${release.name || release.tag_name}</h2>
                            <span class="text-sm text-gray-500">${releaseDate}</span>
                        </div>
                        <div class="release-content text-gray-700">${releaseBodyHtml}</div>
                    `;
                    container.appendChild(releaseElement);
                });
            })
            .catch(error => {
                loadingIndicator.classList.add('hidden');
                console.error('Error fetching release notes:', error);
                container.innerHTML = '<p class="text-center text-red-500">リリース情報の取得に失敗しました。</p>';
            });
    });
  </script>
</body>
</html>

